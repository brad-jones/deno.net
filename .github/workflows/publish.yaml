on:
  workflow_dispatch:
  push:
    branches:
      - master

jobs:
  container:
    uses: ./.github/workflows/_publish.yaml
    secrets: inherit
    permissions:
      id-token: write
      contents: write
      packages: write
      attestations: write
    with:
      project: container

  problem-details:
    uses: ./.github/workflows/_publish.yaml
    secrets: inherit
    permissions:
      id-token: write
      contents: write
      packages: write
      attestations: write
    with:
      project: problem-details

  http-context:
    uses: ./.github/workflows/_publish.yaml
    secrets: inherit
    permissions:
      id-token: write
      contents: write
      packages: write
      attestations: write
    with:
      project: http-context

  logging:
    uses: ./.github/workflows/_publish.yaml
    secrets: inherit
    permissions:
      id-token: write
      contents: write
      packages: write
      attestations: write
    needs:
      - container
    with:
      project: logging

  middleware:
    uses: ./.github/workflows/_publish.yaml
    secrets: inherit
    permissions:
      id-token: write
      contents: write
      packages: write
      attestations: write
    needs:
      - container
      - http-context
      - logging
    with:
      project: middleware

  app-builder:
    uses: ./.github/workflows/_publish.yaml
    secrets: inherit
    permissions:
      id-token: write
      contents: write
      packages: write
      attestations: write
    needs:
      - container
      - problem-details
      - logging
      - http-context
      - middleware
    with:
      project: app-builder

# yaml-language-server: $schema=https://taskfile.dev/schema.json
# https://taskfile.dev
version: 3

dotenv: [".env"]
set: [pipefail]
shopt: [globstar]

tasks:
  init:
    desc: Setup dev env (anything that pixi can't install and setup for us).
    cmds:
      - lefthook install -f
      - git config pull.rebase true
      - git config core.editor "code --wait"
      - git config commit.template "$PWD/.gitmsgtpl"
      - deno install {{if .CI}}--frozen{{end}}
      - "{{if .CI}}git config --global user.name github-actions[bot]{{end}}"
      - "{{if .CI}}git config --global user.email github-actions[bot]@users.noreply.github.com{{end}}"

  lint:
    cmds:
      - task -t ./packages/app-builder/Taskfile.yaml lint
      - task -t ./packages/bundler/Taskfile.yaml lint
      - task -t ./packages/configuration/Taskfile.yaml lint
      - task -t ./packages/container/Taskfile.yaml lint
      - task -t ./packages/formatter/Taskfile.yaml lint
      - task -t ./packages/http-context/Taskfile.yaml lint
      - task -t ./packages/islands/Taskfile.yaml lint
      - task -t ./packages/logging/Taskfile.yaml lint
      - task -t ./packages/middleware/Taskfile.yaml lint
      - task -t ./packages/open-api-client/Taskfile.yaml lint
      - task -t ./packages/problem-details/Taskfile.yaml lint

  test:
    cmds:
      - "deno test -A ./packages/**/*.test.ts"
